/* =========================
   1) DB & Charset
========================= */
CREATE DATABASE IF NOT EXISTS HeThongTuyenDung
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;
USE HeThongTuyenDung;

/* =========================
   2) Dọn bảng (nếu có)
========================= */
DROP TABLE IF EXISTS ThongBao;
DROP TABLE IF EXISTS TinNhan;
DROP TABLE IF EXISTS LichPhongVan;
DROP TABLE IF EXISTS ChatMessage;
DROP TABLE IF EXISTS ChatThread;
DROP TABLE IF EXISTS UngTuyen;
DROP TABLE IF EXISTS TinTuyenDung;
DROP TABLE IF EXISTS NhaTuyenDung_DanhMuc;
DROP TABLE IF EXISTS UngVien_DanhMuc;
DROP TABLE IF EXISTS NhaTuyenDung;
DROP TABLE IF EXISTS UngVien;
DROP TABLE IF EXISTS DanhMucNghe;
DROP TABLE IF EXISTS QuanTriVien;
DROP TABLE IF EXISTS TaiKhoan;
DROP VIEW IF EXISTS v_UngVien_Nghe;
DROP VIEW IF EXISTS v_NTD_Nghe;

/* =========================
   3) Tài khoản / QTV / Danh mục
========================= */
CREATE TABLE TaiKhoan (
  MaTK INT AUTO_INCREMENT PRIMARY KEY,
  Email VARCHAR(100) NOT NULL UNIQUE,
  MatKhau VARCHAR(255) NOT NULL,
  LoaiTaiKhoan ENUM('UngVien', 'NhaTuyenDung') NOT NULL,
  TrangThai ENUM('HoatDong', 'BiKhoa') NOT NULL DEFAULT 'HoatDong',
  NgayTao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

CREATE TABLE QuanTriVien (
  MaQTV INT AUTO_INCREMENT PRIMARY KEY,
  Email VARCHAR(100) NOT NULL UNIQUE,
  MatKhau VARCHAR(255) NOT NULL,
  HoTen VARCHAR(100) NOT NULL,
  TrangThai ENUM('HoatDong', 'BiKhoa') NOT NULL DEFAULT 'HoatDong',
  NgayTao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

CREATE TABLE DanhMucNghe (
  MaDanhMuc INT AUTO_INCREMENT PRIMARY KEY,
  TenDanhMuc VARCHAR(100) NOT NULL,
  UNIQUE KEY uq_DanhMucNghe_TenDanhMuc (TenDanhMuc),
  INDEX idx_DanhMucNghe_TenDanhMuc (TenDanhMuc)
) ENGINE=InnoDB;

/* =========================
   4) Ứng viên / NTD + pivot
========================= */
CREATE TABLE UngVien (
  MaUngVien   INT AUTO_INCREMENT PRIMARY KEY,
  MaTK        INT NOT NULL UNIQUE,
  HoTen       VARCHAR(100) NOT NULL,
  SoDienThoai VARCHAR(15),
  AnhCV       VARCHAR(255),
  KyNang      TEXT,
  KinhNghiem  TEXT,
  MaDanhMuc   INT NULL,
  CreatedAt   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UpdatedAt   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_UV_TK FOREIGN KEY (MaTK) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_UV_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_UngVien_MaTK (MaTK),
  INDEX idx_UngVien_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB;

CREATE TABLE NhaTuyenDung (
  MaNTD         INT AUTO_INCREMENT PRIMARY KEY,
  MaTK          INT NOT NULL UNIQUE,
  TenCongTy     VARCHAR(150) NOT NULL,
  SoDienThoai   VARCHAR(15),
  DiaChi        VARCHAR(255),
  ThongTinCongTy TEXT,
  MaDanhMuc     INT NULL,
  CreatedAt     DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UpdatedAt     DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_NTD_TK FOREIGN KEY (MaTK) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_NTD_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_NTD_MaTK (MaTK),
  INDEX idx_NTD_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB;

CREATE TABLE UngVien_DanhMuc (
  MaUngVien INT NOT NULL,
  MaDanhMuc INT NOT NULL,
  PRIMARY KEY (MaUngVien, MaDanhMuc),
  CONSTRAINT fk_UV_DM_pivot_UV FOREIGN KEY (MaUngVien) REFERENCES UngVien(MaUngVien) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_UV_DM_pivot_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_UV_DM_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB;

CREATE TABLE NhaTuyenDung_DanhMuc (
  MaNTD INT NOT NULL,
  MaDanhMuc INT NOT NULL,
  PRIMARY KEY (MaNTD, MaDanhMuc),
  CONSTRAINT fk_NTD_DM_pivot_NTD FOREIGN KEY (MaNTD) REFERENCES NhaTuyenDung(MaNTD) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_NTD_DM_pivot_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_NTD_DM_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB;

/* =========================
   5) Tin tuyển dụng / Ứng tuyển
========================= */
CREATE TABLE TinTuyenDung (
  MaTin INT AUTO_INCREMENT PRIMARY KEY,
  MaNTD INT NOT NULL,
  MaDanhMuc INT NULL,
  ChucDanh VARCHAR(150) NOT NULL,
  MoTaCongViec TEXT,
  YeuCau TEXT,
  MucLuong VARCHAR(50),
  DiaDiemLamViec VARCHAR(150),
  NgayDang DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  TrangThai ENUM('ChoDuyet', 'DaDuyet', 'TuChoi') NOT NULL DEFAULT 'ChoDuyet',
  CONSTRAINT fk_TTD_NTD FOREIGN KEY (MaNTD) REFERENCES NhaTuyenDung(MaNTD) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_TTD_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_TTD_MaNTD (MaNTD),
  INDEX idx_TTD_MaDanhMuc (MaDanhMuc),
  INDEX idx_TTD_TrangThai_NgayDang (TrangThai, NgayDang)
) ENGINE=InnoDB;

CREATE TABLE UngTuyen (
  MaUngTuyen INT AUTO_INCREMENT PRIMARY KEY,
  MaTin INT NOT NULL,
  MaUngVien INT NOT NULL,
  NgayUngTuyen DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  TrangThai ENUM(
      'DangXet',       -- mặc định khi UV nộp
      'MoiPhongVan',   -- mời phỏng vấn -> ĐƯỢC PHÉP CHAT
      'TuChoi'
  ) NOT NULL DEFAULT 'DangXet',
  UNIQUE KEY uq_UngTuyen (MaTin, MaUngVien),
  CONSTRAINT fk_UT_TTD FOREIGN KEY (MaTin) REFERENCES TinTuyenDung(MaTin) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_UT_UV FOREIGN KEY (MaUngVien) REFERENCES UngVien(MaUngVien) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_UT_TrangThai (TrangThai),
  INDEX idx_UT_MaTin (MaTin),
  INDEX idx_UT_MaUngVien (MaUngVien)
) ENGINE=InnoDB;

/* =========================
   6) Lịch phỏng vấn (tham chiếu UngTuyen)
========================= */
CREATE TABLE LichPhongVan (
  MaLichPV INT AUTO_INCREMENT PRIMARY KEY,
  MaUngTuyen INT NOT NULL,
  NgayGioPhongVan DATETIME NOT NULL,
  HinhThuc ENUM('Online', 'Offline') NOT NULL DEFAULT 'Online',
  TrangThai ENUM('DaLenLich', 'HoanThanh', 'Huy') NOT NULL DEFAULT 'DaLenLich',
  GhiChu TEXT,
  CONSTRAINT fk_LPV_UT FOREIGN KEY (MaUngTuyen) REFERENCES UngTuyen(MaUngTuyen) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_LPV_TrangThai (TrangThai, NgayGioPhongVan)
) ENGINE=InnoDB;

/* =========================
   7) Chat theo bài ứng tuyển (điều kiện: MoiPhongVan)
========================= */
CREATE TABLE ChatThread (
  MaThread INT AUTO_INCREMENT PRIMARY KEY,
  MaTin INT NOT NULL,
  MaUngVien INT NOT NULL,
  MaNTD INT NOT NULL,
  IsOpen TINYINT(1) NOT NULL DEFAULT 1,
  CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY uq_thread (MaTin, MaUngVien, MaNTD),
  INDEX idx_thread_lookup (MaUngVien, MaNTD, MaTin),
  CONSTRAINT fk_thread_tin FOREIGN KEY (MaTin) REFERENCES TinTuyenDung(MaTin)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_thread_uv FOREIGN KEY (MaUngVien) REFERENCES UngVien(MaUngVien)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_thread_ntd FOREIGN KEY (MaNTD) REFERENCES NhaTuyenDung(MaNTD)
    ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

CREATE TABLE ChatMessage (
  MaMsg INT AUTO_INCREMENT PRIMARY KEY,
  MaThread INT NOT NULL,
  SenderType ENUM('UngVien','NhaTuyenDung') NOT NULL,
  MaTK INT NULL,
  NoiDung TEXT NOT NULL,
  CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  IsRead TINYINT(1) NOT NULL DEFAULT 0,
  INDEX idx_msg_thread (MaThread, CreatedAt),
  CONSTRAINT fk_msg_thread FOREIGN KEY (MaThread) REFERENCES ChatThread(MaThread)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_msg_tk FOREIGN KEY (MaTK) REFERENCES TaiKhoan(MaTK)
    ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB;

/* =========================
   8) Hộp thư chung (tùy chọn)
========================= */
CREATE TABLE TinNhan (
  MaTinNhan INT AUTO_INCREMENT PRIMARY KEY,
  MaNguoiGui INT NOT NULL,
  MaNguoiNhan INT NOT NULL,
  NoiDung TEXT NOT NULL,
  NgayGui DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_TN_Gui FOREIGN KEY (MaNguoiGui) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_TN_Nhan FOREIGN KEY (MaNguoiNhan) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_TN_HopThu (MaNguoiNhan, NgayGui),
  INDEX idx_TN_HoiThoai (MaNguoiGui, MaNguoiNhan, NgayGui)
) ENGINE=InnoDB;

/* =========================
   9) Thông báo (tùy chọn)
========================= */
CREATE TABLE ThongBao (
  MaTB INT AUTO_INCREMENT PRIMARY KEY,
  MaNguoiNhan INT NOT NULL,
  LoaiThongBao ENUM('TinTuyenDung', 'UngTuyen', 'TinNhan', 'PhongVan') NOT NULL,
  NoiDung TEXT NOT NULL,
  DaXem BOOLEAN NOT NULL DEFAULT FALSE,
  NgayTao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_TB_Nhan FOREIGN KEY (MaNguoiNhan) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_TB_HopThongBao (MaNguoiNhan, DaXem, NgayTao)
) ENGINE=InnoDB;

/* =========================
   10) VIEW hỗ trợ
========================= */
CREATE VIEW v_UngVien_Nghe AS
SELECT uv.MaUngVien,
       GROUP_CONCAT(dm.TenDanhMuc ORDER BY dm.TenDanhMuc SEPARATOR ', ') AS DanhSachNghe
FROM UngVien uv
LEFT JOIN UngVien_DanhMuc uvdm ON uv.MaUngVien = uvdm.MaUngVien
LEFT JOIN DanhMucNghe dm ON uvdm.MaDanhMuc = dm.MaDanhMuc
GROUP BY uv.MaUngVien;

CREATE VIEW v_NTD_Nghe AS
SELECT ntd.MaNTD,
       GROUP_CONCAT(dm.TenDanhMuc ORDER BY dm.TenDanhMuc SEPARATOR ', ') AS DanhSachNghe
FROM NhaTuyenDung ntd
LEFT JOIN NhaTuyenDung_DanhMuc ndm ON ntd.MaNTD = ndm.MaNTD
LEFT JOIN DanhMucNghe dm ON ndm.MaDanhMuc = dm.MaDanhMuc
GROUP BY ntd.MaNTD;



==============================================================================================================================================================================
==============================================================================================================================================================================
==============================================================================================================================================================================
==============================================================================================================================================================================
==============================================================================================================================================================================
==============================================================================================================================================================================

USE HeThongTuyenDung;

-- ========== 1. Admin
INSERT INTO QuanTriVien (Email, MatKhau, HoTen)
VALUES ('123ad@test.com',
        '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi',
        'Admin Chính');

-- ========== 2. Tài khoản chính
INSERT INTO TaiKhoan (Email, MatKhau, LoaiTaiKhoan) VALUES
('123uv@test.com','$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi','UngVien'),
('123td@test.com','$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi','NhaTuyenDung');

-- Một số tài khoản phụ
INSERT INTO TaiKhoan (Email, MatKhau, LoaiTaiKhoan) VALUES
('uv_extra1@test.com','$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi','UngVien'),
('uv_extra2@test.com','$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi','UngVien'),
('ntd_extra1@test.com','$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi','NhaTuyenDung');

-- Lấy ID
SET @tk_uv := (SELECT MaTK FROM TaiKhoan WHERE Email='123uv@test.com');
SET @tk_ntd := (SELECT MaTK FROM TaiKhoan WHERE Email='123td@test.com');
SET @tk_uv_ex1 := (SELECT MaTK FROM TaiKhoan WHERE Email='uv_extra1@test.com');
SET @tk_uv_ex2 := (SELECT MaTK FROM TaiKhoan WHERE Email='uv_extra2@test.com');
SET @tk_ntd_ex1 := (SELECT MaTK FROM TaiKhoan WHERE Email='ntd_extra1@test.com');

-- ========== 3. Danh mục nghề
INSERT INTO DanhMucNghe (TenDanhMuc) VALUES
('CNTT - Lập trình'),
('Kinh doanh - Bán hàng'),
('Thiết kế đồ họa'),
('Nhân sự'),
('Kế toán'),
('Marketing');

-- ========== 4. Ứng viên
INSERT INTO UngVien (MaTK, HoTen, SoDienThoai, KyNang, KinhNghiem, MaDanhMuc) VALUES
(@tk_uv,'Ứng viên Chính','0901111111','Java, PHP, SQL','3 năm kinh nghiệm',1),
(@tk_uv_ex1,'Nguyễn Văn B','0902222222','React, NodeJS','1 năm kinh nghiệm',1),
(@tk_uv_ex2,'Trần Thị C','0903333333','Sale, Marketing','Fresher',2);

-- ========== 5. Nhà tuyển dụng
INSERT INTO NhaTuyenDung (MaTK, TenCongTy, SoDienThoai, DiaChi, ThongTinCongTy, MaDanhMuc) VALUES
(@tk_ntd,'Công ty Test NTD','0911111111','Hà Nội','Công ty phần mềm lớn',1),
(@tk_ntd_ex1,'Công ty Extra NTD','0914444444','TP.HCM','Công ty thương mại điện tử',2);

-- ========== 6. Tin tuyển dụng (của 123td@test.com)
INSERT INTO TinTuyenDung (MaNTD, MaDanhMuc, ChucDanh, MoTaCongViec, YeuCau, MucLuong, DiaDiemLamViec, TrangThai)
VALUES
((SELECT MaNTD FROM NhaTuyenDung WHERE MaTK=@tk_ntd),1,'Lập trình viên PHP','Xây dựng website','Biết PHP, MySQL','15-20 triệu','Hà Nội','DaDuyet'),
((SELECT MaNTD FROM NhaTuyenDung WHERE MaTK=@tk_ntd),1,'Tester phần mềm','Kiểm thử hệ thống','Kinh nghiệm test','12-15 triệu','Hà Nội','DaDuyet'),
((SELECT MaNTD FROM NhaTuyenDung WHERE MaTK=@tk_ntd),2,'Nhân viên kinh doanh','Tìm kiếm khách hàng','Kỹ năng sale','10-12 triệu','Hà Nội','ChoDuyet');

-- Tin tuyển dụng của NTD phụ
INSERT INTO TinTuyenDung (MaNTD, MaDanhMuc, ChucDanh, MoTaCongViec, YeuCau, MucLuong, DiaDiemLamViec, TrangThai)
VALUES
((SELECT MaNTD FROM NhaTuyenDung WHERE MaTK=@tk_ntd_ex1),2,'Sale Online','Bán hàng online','Có kinh nghiệm','8-10 triệu','TP.HCM','DaDuyet');

-- ========== 7. Ứng tuyển
-- UV chính apply nhiều tin, với đủ 3 trạng thái
INSERT INTO UngTuyen (MaTin, MaUngVien, TrangThai) VALUES
(1,(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv),'DangXet'),
(2,(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv),'MoiPhongVan'),
(3,(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv),'TuChoi');

-- UV phụ apply vào tin
INSERT INTO UngTuyen (MaTin, MaUngVien, TrangThai) VALUES
(1,(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv_ex1),'MoiPhongVan'),
(4,(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv_ex2),'DangXet');

-- ========== 8. Lịch phỏng vấn
INSERT INTO LichPhongVan (MaUngTuyen, NgayGioPhongVan, HinhThuc, TrangThai, GhiChu)
VALUES
(2,'2025-09-05 09:00:00','Online','DaLenLich','PV qua Zoom'),
(5,'2025-09-06 14:00:00','Offline','DaLenLich','PV trực tiếp tại văn phòng');

-- ========== 9. ChatThread & ChatMessage
-- Tạo thread cho UV chính (MoiPhongVan)
INSERT INTO ChatThread (MaTin, MaUngVien, MaNTD)
SELECT ut.MaTin, ut.MaUngVien, ttd.MaNTD
FROM UngTuyen ut
JOIN TinTuyenDung ttd ON ut.MaTin=ttd.MaTin
WHERE ut.MaUngVien=(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv) AND ut.TrangThai='MoiPhongVan'
LIMIT 1;

-- Thread cho UV phụ (MoiPhongVan)
INSERT INTO ChatThread (MaTin, MaUngVien, MaNTD)
SELECT ut.MaTin, ut.MaUngVien, ttd.MaNTD
FROM UngTuyen ut
JOIN TinTuyenDung ttd ON ut.MaTin=ttd.MaTin
WHERE ut.MaUngVien=(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv_ex1) AND ut.TrangThai='MoiPhongVan'
LIMIT 1;

-- Tin nhắn chat cho UV chính
SET @thr_main := (SELECT MaThread FROM ChatThread ct
JOIN UngTuyen ut ON ct.MaTin=ut.MaTin AND ct.MaUngVien=ut.MaUngVien
WHERE ut.MaUngVien=(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv) LIMIT 1);

INSERT INTO ChatMessage (MaThread, SenderType, NoiDung) VALUES
(@thr_main,'UngVien','Chào anh, em đã nhận được lời mời PV'),
(@thr_main,'NhaTuyenDung','Chào em, buổi PV diễn ra 05/09, chuẩn bị nhé'),
(@thr_main,'UngVien','Dạ vâng, em sẽ chuẩn bị CV và các dự án');

-- Tin nhắn chat cho UV phụ
SET @thr_ex1 := (SELECT MaThread FROM ChatThread ct
JOIN UngTuyen ut ON ct.MaTin=ut.MaTin AND ct.MaUngVien=ut.MaUngVien
WHERE ut.MaUngVien=(SELECT MaUngVien FROM UngVien WHERE MaTK=@tk_uv_ex1) LIMIT 1);

INSERT INTO ChatMessage (MaThread, SenderType, NoiDung) VALUES
(@thr_ex1,'UngVien','Em quan tâm vị trí PHP Developer'),
(@thr_ex1,'NhaTuyenDung','Ok em, hẹn em buổi phỏng vấn vào tuần sau');

-- ========== 10. TinNhan (hộp thư chung)
INSERT INTO TinNhan (MaNguoiGui, MaNguoiNhan, NoiDung)
VALUES
(@tk_uv,@tk_ntd,'Em đã nộp hồ sơ ứng tuyển'),
(@tk_ntd,@tk_uv,'Chúng tôi đã nhận được hồ sơ của bạn'),
(@tk_uv_ex2,@tk_ntd_ex1,'Em muốn ứng tuyển vị trí sale online');

-- ========== 11. Thông báo
INSERT INTO ThongBao (MaNguoiNhan, LoaiThongBao, NoiDung)
VALUES
(@tk_uv,'UngTuyen','Bạn đã được mời phỏng vấn cho vị trí Tester'),
(@tk_uv,'UngTuyen','Hồ sơ của bạn cho vị trí Kinh doanh đã bị từ chối'),
(@tk_ntd,'TinTuyenDung','Tin tuyển dụng Lập trình viên PHP đã được duyệt'),
(@tk_ntd,'UngTuyen','Có ứng viên mới nộp hồ sơ'),
(@tk_ntd_ex1,'UngTuyen','Ứng viên Trần Thị C vừa ứng tuyển');
