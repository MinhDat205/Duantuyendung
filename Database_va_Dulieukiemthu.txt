cho tôi mã sql tạo dữ liệu kiểm thử
-- 1. DB & Charset
CREATE DATABASE IF NOT EXISTS HeThongTuyenDung
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;
USE HeThongTuyenDung;

-- 2. Bảng Tài Khoản
CREATE TABLE TaiKhoan (
  MaTK INT AUTO_INCREMENT PRIMARY KEY,
  Email VARCHAR(100) NOT NULL UNIQUE,
  MatKhau VARCHAR(255) NOT NULL,
  LoaiTaiKhoan ENUM('UngVien', 'NhaTuyenDung') NOT NULL,
  TrangThai ENUM('HoatDong', 'BiKhoa') NOT NULL DEFAULT 'HoatDong',
  NgayTao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB COMMENT='Thông tin tài khoản ứng viên và nhà tuyển dụng';

-- 3. Bảng Quản Trị Viên
CREATE TABLE QuanTriVien (
  MaQTV INT AUTO_INCREMENT PRIMARY KEY,
  Email VARCHAR(100) NOT NULL UNIQUE,
  MatKhau VARCHAR(255) NOT NULL,
  HoTen VARCHAR(100) NOT NULL,
  TrangThai ENUM('HoatDong', 'BiKhoa') NOT NULL DEFAULT 'HoatDong',
  NgayTao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB COMMENT='Thông tin quản trị viên';

-- 4. Danh Mục Nghề
CREATE TABLE DanhMucNghe (
  MaDanhMuc INT AUTO_INCREMENT PRIMARY KEY,
  TenDanhMuc VARCHAR(100) NOT NULL,
  UNIQUE KEY uq_DanhMucNghe_TenDanhMuc (TenDanhMuc),
  INDEX idx_DanhMucNghe_TenDanhMuc (TenDanhMuc)
) ENGINE=InnoDB COMMENT='Danh mục ngành nghề';

-- 5. Ứng Viên (giữ MaDanhMuc là ngành chính để tương thích; thêm AnhCV)
CREATE TABLE UngVien (
  MaUngVien   INT AUTO_INCREMENT PRIMARY KEY,
  MaTK        INT NOT NULL UNIQUE,
  HoTen       VARCHAR(100) NOT NULL,
  SoDienThoai VARCHAR(15),
  AnhCV       VARCHAR(255),  -- đường dẫn ảnh/file CV
  KyNang      TEXT,
  KinhNghiem  TEXT,
  MaDanhMuc   INT NULL,      -- ngành chính (tùy chọn)
  CreatedAt   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UpdatedAt   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_UV_TK FOREIGN KEY (MaTK) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_UV_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_UngVien_MaTK (MaTK),
  INDEX idx_UngVien_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB COMMENT='Thông tin ứng viên';

-- 6. Nhà Tuyển Dụng (giữ MaDanhMuc là ngành chính; hỗ trợ multi bằng pivot)
CREATE TABLE NhaTuyenDung (
  MaNTD         INT AUTO_INCREMENT PRIMARY KEY,
  MaTK          INT NOT NULL UNIQUE,
  TenCongTy     VARCHAR(150) NOT NULL,
  SoDienThoai   VARCHAR(15),
  DiaChi        VARCHAR(255),
  ThongTinCongTy TEXT,
  MaDanhMuc     INT NULL,    -- ngành chính (tùy chọn)
  CreatedAt     DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UpdatedAt     DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT fk_NTD_TK FOREIGN KEY (MaTK) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_NTD_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_NTD_MaTK (MaTK),
  INDEX idx_NTD_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB COMMENT='Thông tin nhà tuyển dụng';

-- 6b. Pivot: Ứng viên - Danh mục (nhiều-nhiều)
CREATE TABLE UngVien_DanhMuc (
  MaUngVien INT NOT NULL,
  MaDanhMuc INT NOT NULL,
  PRIMARY KEY (MaUngVien, MaDanhMuc),
  CONSTRAINT fk_UV_DM_pivot_UV FOREIGN KEY (MaUngVien) REFERENCES UngVien(MaUngVien) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_UV_DM_pivot_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_UV_DM_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB COMMENT='Ứng viên có thể thuộc nhiều ngành';

-- 6c. Pivot: NTD - Danh mục (nhiều-nhiều)
CREATE TABLE NhaTuyenDung_DanhMuc (
  MaNTD INT NOT NULL,
  MaDanhMuc INT NOT NULL,
  PRIMARY KEY (MaNTD, MaDanhMuc),
  CONSTRAINT fk_NTD_DM_pivot_NTD FOREIGN KEY (MaNTD) REFERENCES NhaTuyenDung(MaNTD) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_NTD_DM_pivot_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_NTD_DM_MaDanhMuc (MaDanhMuc)
) ENGINE=InnoDB COMMENT='NTD có thể thuộc nhiều ngành';

-- 7. Tin Tuyển Dụng (giữ 1 ngành chính để đơn giản lọc)
CREATE TABLE TinTuyenDung (
  MaTin INT AUTO_INCREMENT PRIMARY KEY,
  MaNTD INT NOT NULL,
  MaDanhMuc INT NULL,
  ChucDanh VARCHAR(150) NOT NULL,
  MoTaCongViec TEXT,
  YeuCau TEXT,
  MucLuong VARCHAR(50),
  DiaDiemLamViec VARCHAR(150),
  NgayDang DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  TrangThai ENUM('ChoDuyet', 'DaDuyet', 'TuChoi') NOT NULL DEFAULT 'ChoDuyet',
  CONSTRAINT fk_TTD_NTD FOREIGN KEY (MaNTD) REFERENCES NhaTuyenDung(MaNTD) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_TTD_DM FOREIGN KEY (MaDanhMuc) REFERENCES DanhMucNghe(MaDanhMuc) ON DELETE SET NULL ON UPDATE CASCADE,
  INDEX idx_TTD_MaNTD (MaNTD),
  INDEX idx_TTD_MaDanhMuc (MaDanhMuc),
  INDEX idx_TTD_TrangThai_NgayDang (TrangThai, NgayDang)
) ENGINE=InnoDB COMMENT='Thông tin tin tuyển dụng';

-- 8. Ứng Tuyển
CREATE TABLE UngTuyen (
  MaUngTuyen INT AUTO_INCREMENT PRIMARY KEY,
  MaTin INT NOT NULL,
  MaUngVien INT NOT NULL,
  NgayUngTuyen DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  TrangThai ENUM('DangXet', 'MoiPhongVan', 'TuChoi') NOT NULL DEFAULT 'DangXet',
  UNIQUE KEY uq_UngTuyen (MaTin, MaUngVien),
  CONSTRAINT fk_UT_TTD FOREIGN KEY (MaTin) REFERENCES TinTuyenDung(MaTin) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_UT_UV FOREIGN KEY (MaUngVien) REFERENCES UngVien(MaUngVien) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_UT_TrangThai (TrangThai)
) ENGINE=InnoDB COMMENT='Thông tin ứng tuyển';

-- 9. Lịch Phỏng Vấn
CREATE TABLE LichPhongVan (
  MaLichPV INT AUTO_INCREMENT PRIMARY KEY,
  MaUngTuyen INT NOT NULL,
  NgayGioPhongVan DATETIME NOT NULL,
  HinhThuc ENUM('Online', 'Offline') NOT NULL DEFAULT 'Online',
  TrangThai ENUM('DaLenLich', 'HoanThanh', 'Huy') NOT NULL DEFAULT 'DaLenLich',
  GhiChu TEXT,
  CONSTRAINT fk_LPV_UT FOREIGN KEY (MaUngTuyen) REFERENCES UngTuyen(MaUngTuyen) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_LPV_TrangThai (TrangThai, NgayGioPhongVan)
) ENGINE=InnoDB COMMENT='Thông tin lịch phỏng vấn';

-- 10. Tin Nhắn
CREATE TABLE TinNhan (
  MaTinNhan INT AUTO_INCREMENT PRIMARY KEY,
  MaNguoiGui INT NOT NULL,
  MaNguoiNhan INT NOT NULL,
  NoiDung TEXT NOT NULL,
  NgayGui DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_TN_Gui FOREIGN KEY (MaNguoiGui) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT fk_TN_Nhan FOREIGN KEY (MaNguoiNhan) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_TN_HopThu (MaNguoiNhan, NgayGui),
  INDEX idx_TN_HoiThoai (MaNguoiGui, MaNguoiNhan, NgayGui)
) ENGINE=InnoDB COMMENT='Tin nhắn giữa các tài khoản';

-- 11. Thông Báo
CREATE TABLE ThongBao (
  MaTB INT AUTO_INCREMENT PRIMARY KEY,
  MaNguoiNhan INT NOT NULL,
  LoaiThongBao ENUM('TinTuyenDung', 'UngTuyen', 'TinNhan', 'PhongVan') NOT NULL,
  NoiDung TEXT NOT NULL,
  DaXem BOOLEAN NOT NULL DEFAULT FALSE,
  NgayTao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_TB_Nhan FOREIGN KEY (MaNguoiNhan) REFERENCES TaiKhoan(MaTK) ON DELETE CASCADE ON UPDATE CASCADE,
  INDEX idx_TB_HopThongBao (MaNguoiNhan, DaXem, NgayTao)
) ENGINE=InnoDB COMMENT='Thông tin thông báo';

-- 12. OTP Reset mật khẩu
CREATE TABLE PasswordReset (
  Email VARCHAR(100) NOT NULL,
  OTP VARCHAR(6) NOT NULL,
  ExpireAt DATETIME NOT NULL,
  PRIMARY KEY (Email),
  INDEX idx_PR_ExpireAt (ExpireAt)
) ENGINE=InnoDB COMMENT='OTP reset mật khẩu';

-- (Tuỳ chọn) VIEW hỗ trợ lấy danh sách ngành theo người dùng
CREATE OR REPLACE VIEW v_UngVien_Nghe AS
SELECT uv.MaUngVien,
       GROUP_CONCAT(dm.TenDanhMuc ORDER BY dm.TenDanhMuc SEPARATOR ', ') AS DanhSachNghe
FROM UngVien uv
LEFT JOIN UngVien_DanhMuc uvdm ON uv.MaUngVien = uvdm.MaUngVien
LEFT JOIN DanhMucNghe dm ON uvdm.MaDanhMuc = dm.MaDanhMuc
GROUP BY uv.MaUngVien;

CREATE OR REPLACE VIEW v_NTD_Nghe AS
SELECT ntd.MaNTD,
       GROUP_CONCAT(dm.TenDanhMuc ORDER BY dm.TenDanhMuc SEPARATOR ', ') AS DanhSachNghe
FROM NhaTuyenDung ntd
LEFT JOIN NhaTuyenDung_DanhMuc ndm ON ntd.MaNTD = ndm.MaNTD
LEFT JOIN DanhMucNghe dm ON ndm.MaDanhMuc = dm.MaDanhMuc
GROUP BY ntd.MaNTD;


------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------

-- 1. Chèn dữ liệu vào bảng DanhMucNghe
INSERT INTO DanhMucNghe (TenDanhMuc) VALUES
('Công nghệ thông tin'),
('Kinh doanh & Bán hàng'),
('Kế toán & Tài chính'),
('Nhân sự'),
('Marketing');

-- 2. Chèn dữ liệu vào bảng TaiKhoan
INSERT INTO TaiKhoan (Email, MatKhau, LoaiTaiKhoan, TrangThai, NgayTao) VALUES
('ungvien1@gmail.com', '$2a$10$hashedpassword1', 'UngVien', 'HoatDong', '2025-08-01 10:00:00'),
('ungvien2@gmail.com', '$2a$10$hashedpassword2', 'UngVien', 'HoatDong', '2025-08-02 12:00:00'),
('ntd1@company.com', '$2a$10$hashedpassword3', 'NhaTuyenDung', 'HoatDong', '2025-08-01 09:00:00'),
('ntd2@company.com', '$2a$10$hashedpassword4', 'NhaTuyenDung', 'HoatDong', '2025-08-03 15:00:00');

-- 3. Chèn dữ liệu vào bảng QuanTriVien
INSERT INTO QuanTriVien (Email, MatKhau, HoTen, TrangThai, NgayTao) VALUES
('admin1@xai.com', '$2a$10$hashedpassword5', 'Nguyen Van Admin', 'HoatDong', '2025-08-01 08:00:00'),
('admin2@xai.com', '$2a$10$hashedpassword6', 'Tran Thi Admin', 'HoatDong', '2025-08-02 09:00:00');

-- 4. Chèn dữ liệu vào bảng UngVien
INSERT INTO UngVien (MaTK, HoTen, SoDienThoai, AnhCV, KyNang, KinhNghiem, MaDanhMuc, CreatedAt, UpdatedAt) VALUES
(1, 'Nguyen Van A', '0901234567', '/cv/ungvien1.pdf', 'Java, Python, SQL', '2 năm làm việc tại Công ty ABC', 1, '2025-08-01 10:00:00', '2025-08-01 10:00:00'),
(2, 'Tran Thi B', '0912345678', '/cv/ungvien2.pdf', 'Marketing, SEO, Content', '3 năm kinh nghiệm tại Agency XYZ', 5, '2025-08-02 12:00:00', '2025-08-02 12:00:00');

-- 5. Chèn dữ liệu vào bảng NhaTuyenDung
INSERT INTO NhaTuyenDung (MaTK, TenCongTy, SoDienThoai, DiaChi, ThongTinCongTy, MaDanhMuc, CreatedAt, UpdatedAt) VALUES
(3, 'Công ty TNHH TechStar', '0987654321', '123 Đường Láng, Hà Nội', 'Công ty công nghệ hàng đầu', 1, '2025-08-01 09:00:00', '2025-08-01 09:00:00'),
(4, 'Công ty CP SalePlus', '0976543210', '456 Nguyễn Huệ, TP.HCM', 'Doanh nghiệp bán hàng đa ngành', 2, '2025-08-03 15:00:00', '2025-08-03 15:00:00');

-- 6. Chèn dữ liệu vào bảng UngVien_DanhMuc (nhiều ngành cho ứng viên)
INSERT INTO UngVien_DanhMuc (MaUngVien, MaDanhMuc) VALUES
(1, 1), -- Nguyen Van A: Công nghệ thông tin
(1, 3), -- Nguyen Van A: Kế toán & Tài chính
(2, 5), -- Tran Thi B: Marketing
(2, 2); -- Tran Thi B: Kinh doanh & Bán hàng

-- 7. Chèn dữ liệu vào bảng NhaTuyenDung_DanhMuc (nhiều ngành cho NTD)
INSERT INTO NhaTuyenDung_DanhMuc (MaNTD, MaDanhMuc) VALUES
(1, 1), -- TechStar: Công nghệ thông tin
(1, 4), -- TechStar: Nhân sự
(2, 2), -- SalePlus: Kinh doanh & Bán hàng
(2, 5); -- SalePlus: Marketing

-- 8. Chèn dữ liệu vào bảng TinTuyenDung
INSERT INTO TinTuyenDung (MaNTD, MaDanhMuc, ChucDanh, MoTaCongViec, YeuCau, MucLuong, DiaDiemLamViec, NgayDang, TrangThai) VALUES
(1, 1, 'Lập trình viên Java', 'Phát triển ứng dụng web', '2 năm kinh nghiệm Java, Spring', '20-30 triệu', 'Hà Nội', '2025-08-10 08:00:00', 'DaDuyet'),
(2, 2, 'Nhân viên kinh doanh', 'Tìm kiếm và chăm sóc khách hàng', 'Kỹ năng giao tiếp, 1 năm kinh nghiệm', '15-25 triệu', 'TP.HCM', '2025-08-11 09:00:00', 'DaDuyet'),
(1, 4, 'Chuyên viên nhân sự', 'Tuyển dụng và quản lý nhân sự', '2 năm kinh nghiệm HR', '18-25 triệu', 'Hà Nội', '2025-08-12 10:00:00', 'ChoDuyet');

-- 9. Chèn dữ liệu vào bảng UngTuyen
INSERT INTO UngTuyen (MaTin, MaUngVien, NgayUngTuyen, TrangThai) VALUES
(1, 1, '2025-08-11 10:00:00', 'DangXet'), -- Nguyen Van A ứng tuyển Lập trình viên Java
(2, 2, '2025-08-12 11:00:00', 'MoiPhongVan'), -- Tran Thi B ứng tuyển Nhân viên kinh doanh
(1, 2, '2025-08-12 12:00:00', 'TuChoi'); -- Tran Thi B ứng tuyển Lập trình viên Java (bị từ chối)

-- 10. Chèn dữ liệu vào bảng LichPhongVan
INSERT INTO LichPhongVan (MaUngTuyen, NgayGioPhongVan, HinhThuc, TrangThai, GhiChu) VALUES
(2, '2025-08-15 14:00:00', 'Online', 'DaLenLich', 'Phỏng vấn qua Zoom');

-- 11. Chèn dữ liệu vào bảng TinNhan
INSERT INTO TinNhan (MaNguoiGui, MaNguoiNhan, NoiDung, NgayGui) VALUES
(1, 3, 'Chào anh/chị, tôi quan tâm đến vị trí Lập trình viên Java', '2025-08-11 10:30:00'),
(3, 1, 'Cảm ơn bạn đã quan tâm. Vui lòng gửi CV chi tiết.', '2025-08-11 11:00:00'),
(2, 4, 'Chào anh/chị, tôi muốn ứng tuyển vị trí Nhân viên kinh doanh', '2025-08-12 11:30:00');

-- 12. Chèn dữ liệu vào bảng ThongBao
INSERT INTO ThongBao (MaNguoiNhan, LoaiThongBao, NoiDung, DaXem, NgayTao) VALUES
(1, 'UngTuyen', 'Ứng tuyển của bạn cho vị trí Lập trình viên Java đã được gửi', FALSE, '2025-08-11 10:00:00'),
(2, 'PhongVan', 'Bạn được mời phỏng vấn cho vị trí Nhân viên kinh doanh', FALSE, '2025-08-12 11:30:00'),
(3, 'TinNhan', 'Bạn nhận được tin nhắn mới từ Nguyen Van A', TRUE, '2025-08-11 10:30:00');

-- 13. Chèn dữ liệu vào bảng PasswordReset
INSERT INTO PasswordReset (Email, OTP, ExpireAt) VALUES
('ungvien1@gmail.com', '123456', '2025-08-25 15:00:00'),
('ntd1@company.com', '654321', '2025-08-25 16:00:00');