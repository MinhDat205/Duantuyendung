<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fidovn - Chi tiết tin tuyển dụng</title>
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'fido-orange': '#FF6B35',
                        'fido-dark': '#2D3748'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-item.is-active {
            background-color: #FF6B35 !important;
            color: white !important;
        }
        .sidebar-item:hover {
            background-color: #f3f4f6;
        }
        .job-detail-card {
            transition: all 0.3s ease;
        }
        .job-detail-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-fido-dark text-white shadow-lg">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-white">Fidovn</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="main.html" class="flex items-center space-x-2 hover:text-fido-orange transition-colors">
                        <i class="fas fa-home"></i>
                        <span>Trang chủ</span>
                    </a>
                    <a href="vieclam.html" class="flex items-center space-x-2 hover:text-fido-orange transition-colors">
                        <i class="fas fa-briefcase"></i>
                        <span>Việc làm</span>
                    </a>
                    <a href="#" class="flex items-center space-x-2 hover:text-fido-orange transition-colors">
                        <i class="fas fa-building"></i>
                        <span>Công ty</span>
                    </a>
                </nav>
                <div class="flex items-center space-x-4">
                    <div id="userInfo" class="hidden">
                        <span class="text-white mr-3" id="userName"></span>
                        <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm transition-colors">
                            Đăng xuất
                        </button>
                    </div>
                    <div id="loginButtons">
                        <a href="../login.html" class="bg-fido-orange hover:bg-orange-600 px-4 py-2 rounded text-sm transition-colors">
                            Đăng nhập
                        </a>
                        <a href="../register.html" class="ml-2 bg-transparent border border-white hover:bg-white hover:text-fido-dark px-4 py-2 rounded text-sm transition-colors">
                            Đăng ký
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <div class="bg-white border-b">
        <div class="container mx-auto px-4 py-2">
            <nav class="text-sm text-gray-600">
                <a href="main.html" class="hover:text-fido-orange">Trang chủ</a>
                <span class="mx-2">/</span>
                <a href="vieclam.html" class="hover:text-fido-orange">Việc làm</a>
                <span class="mx-2">/</span>
                <span id="jobTitle">Chi tiết tin tuyển dụng</span>
            </nav>
        </div>
    </div>

    <div class="flex min-h-screen bg-gray-50">
        <!-- Sidebar Left (280px) -->
        <aside id="uv-sidebar" class="w-70 bg-white shadow-lg">
            <div class="p-6">
                <!-- Profile Brief Card -->
                <div class="uv-brief-card bg-orange-500 rounded-lg p-4 mb-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white font-bold text-lg">T</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-white font-semibold">Thắng Trương Văn</h4>
                            <p class="text-white text-sm opacity-90">ID: #45824901</p>
                            <p class="text-white text-sm opacity-90">thangtv5280@ut.edu.vn</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Menu -->
                <nav class="space-y-2">
                    <a href="dashboard.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-tv text-blue-500"></i>
                        <span>Tổng quan</span>
                    </a>
                    <a href="thong-tin-ca-nhan.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-user text-orange-500"></i>
                        <span>Thông tin cá nhân</span>
                    </a>
                    <a href="quan-ly-cv.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-file-alt text-emerald-500"></i>
                        <span>Quản lý CV</span>
                    </a>
                    <a href="vieclam.html" class="sidebar-item is-active flex items-center space-x-3 p-3 rounded-lg">
                        <i class="fas fa-briefcase text-cyan-500"></i>
                        <span>Quản lý việc làm</span>
                    </a>
                    <a href="ung-tuyen-cua-toi.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-paper-plane text-purple-500"></i>
                        <span>Ứng tuyển của tôi</span>
                    </a>
                    <a href="tin-da-luu.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-bookmark text-yellow-500"></i>
                        <span>Tin đã lưu</span>
                    </a>
                    <a href="lich-phong-van.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-calendar text-pink-500"></i>
                        <span>Lịch phỏng vấn</span>
                    </a>
                    <a href="theo-doi.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-heart text-red-500"></i>
                        <span>Theo dõi</span>
                    </a>
                    <a href="profile.html" class="sidebar-item flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-cog text-gray-500"></i>
                        <span>Quản lý tài khoản</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content Right (flex 1) -->
        <main class="flex-1 p-8">
            <div class="max-w-6xl mx-auto">
                <!-- Job Header -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <span id="hotBadge" class="bg-red-500 text-white text-xs px-2 py-1 rounded hidden">HOT</span>
                                <span id="urgentBadge" class="bg-orange-500 text-white text-xs px-2 py-1 rounded hidden">TUYỂN GẤP</span>
                            </div>
                            <h1 id="jobTitleMain" class="text-2xl font-bold text-gray-800 mb-2">Đang tải...</h1>
                            <p id="jobSalary" class="text-fido-orange text-lg font-semibold mb-2">Đang tải...</p>
                            <p id="jobLocation" class="text-gray-600 mb-2">Đang tải...</p>
                            <p id="jobType" class="text-gray-600">Đang tải...</p>
                        </div>
                        <div class="flex flex-col gap-3">
                            <button id="saveJobBtn" class="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-bookmark"></i>
                                <span>Lưu tin</span>
                            </button>
                            <button id="shareJobBtn" class="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-share"></i>
                                <span>Chia sẻ</span>
                            </button>
                        </div>
                    </div>

                    <!-- Company Info -->
                    <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg">
                        <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                            <span id="companyLogo" class="text-xl font-bold text-gray-600">C</span>
                        </div>
                        <div class="flex-1">
                            <h3 id="companyName" class="text-lg font-semibold text-gray-800">Đang tải...</h3>
                            <div class="flex items-center space-x-1">
                                <i class="fas fa-check-circle text-green-500 text-xs"></i>
                                <span class="text-xs text-green-500">Đã xác thực</span>
                            </div>
                        </div>
                        <button id="applyNowBtn" class="bg-fido-orange text-white px-8 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors">
                            Ứng tuyển ngay
                        </button>
                    </div>
                </div>

                <!-- Job Details Grid -->
                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Left Column - Job Description -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Job Description -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Mô tả công việc</h2>
                            <div id="jobDescription" class="prose max-w-none">
                                <p>Đang tải mô tả công việc...</p>
                            </div>
                        </div>

                        <!-- Job Requirements -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Yêu cầu ứng viên</h2>
                            <div id="jobRequirements" class="prose max-w-none">
                                <p>Đang tải yêu cầu...</p>
                            </div>
                        </div>

                        <!-- Job Benefits -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Quyền lợi</h2>
                            <div id="jobBenefits" class="prose max-w-none">
                                <p>Đang tải quyền lợi...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Job Info & Actions -->
                    <div class="space-y-6">
                        <!-- Job Information -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Thông tin việc làm</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Mức lương:</span>
                                    <span id="salaryInfo" class="font-medium">Đang tải...</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Kinh nghiệm:</span>
                                    <span id="experienceInfo" class="font-medium">Đang tải...</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Bằng cấp:</span>
                                    <span id="educationInfo" class="font-medium">Đang tải...</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Hình thức:</span>
                                    <span id="typeInfo" class="font-medium">Đang tải...</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Địa điểm:</span>
                                    <span id="locationInfo" class="font-medium">Đang tải...</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Ngày đăng:</span>
                                    <span id="postedDateInfo" class="font-medium">Đang tải...</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Hạn nộp:</span>
                                    <span id="deadlineInfo" class="font-medium">Đang tải...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Similar Jobs -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Việc làm tương tự</h3>
                            <div id="similarJobs" class="space-y-3">
                                <p class="text-gray-500 text-sm">Đang tải việc làm tương tự...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        let currentJob = null;
        let isJobSaved = false;

        // Get job ID from URL
        function getJobId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Load job details
        async function loadJobDetails() {
            const jobId = getJobId();
            if (!jobId) {
                showError('Không tìm thấy ID việc làm');
                return;
            }

            try {
                const response = await fetch(`../../API/jobs/detail.php?id=${jobId}`);
                const data = await response.json();
                
                if (data.ok) {
                    currentJob = data.data;
                    displayJobDetails(currentJob);
                } else {
                    showError('Không thể tải thông tin việc làm');
                }
            } catch (error) {
                console.error('Error loading job details:', error);
                // For demo purposes, load mock data
                loadMockJobData();
            }
        }

        // Load mock data for demonstration
        function loadMockJobData() {
            const mockJob = {
                id: getJobId() || 1,
                title: "CHUYÊN VIÊN DIGITAL MARKETING",
                salary: "15 triệu - 25 triệu /tháng",
                location: "Hồ Chí Minh, Quận 1",
                type: "Toàn thời gian",
                company: "CÔNG TY TNHH DIGITAL SOLUTIONS",
                logo: "DIGITAL",
                isHot: true,
                isUrgent: false,
                postedDate: "2 ngày trước",
                experience: "2-5 năm",
                education: "Đại học",
                description: `
                    <p>Chúng tôi đang tìm kiếm một Chuyên viên Digital Marketing có kinh nghiệm để tham gia vào đội ngũ marketing năng động của công ty.</p>
                    <h4>Trách nhiệm chính:</h4>
                    <ul>
                        <li>Lập kế hoạch và thực hiện chiến dịch marketing trên các nền tảng digital</li>
                        <li>Quản lý và tối ưu hóa quảng cáo Google Ads, Facebook Ads</li>
                        <li>Phân tích dữ liệu và báo cáo hiệu quả marketing</li>
                        <li>Xây dựng nội dung marketing hấp dẫn</li>
                        <li>Làm việc với các đối tác và agency</li>
                    </ul>
                `,
                requirements: `
                    <ul>
                        <li>Tốt nghiệp Đại học chuyên ngành Marketing, Kinh tế hoặc liên quan</li>
                        <li>Có 2-5 năm kinh nghiệm trong lĩnh vực Digital Marketing</li>
                        <li>Thành thạo các công cụ Google Ads, Facebook Ads, Google Analytics</li>
                        <li>Có khả năng phân tích dữ liệu và báo cáo</li>
                        <li>Kỹ năng giao tiếp và làm việc nhóm tốt</li>
                        <li>Tiếng Anh giao tiếp cơ bản</li>
                    </ul>
                `,
                benefits: `
                    <ul>
                        <li>Môi trường làm việc trẻ trung, năng động</li>
                        <li>Lương thưởng cạnh tranh theo năng lực</li>
                        <li>Được đào tạo và phát triển kỹ năng</li>
                        <li>Bảo hiểm xã hội, bảo hiểm y tế đầy đủ</li>
                        <li>Du lịch công ty hàng năm</li>
                        <li>Cơ hội thăng tiến rõ ràng</li>
                    </ul>
                `,
                deadline: "30/12/2024"
            };

            currentJob = mockJob;
            displayJobDetails(mockJob);
        }

        // Display job details
        function displayJobDetails(job) {
            // Update page title
            document.title = `Fidovn - ${job.title}`;
            document.getElementById('jobTitle').textContent = job.title;
            document.getElementById('jobTitleMain').textContent = job.title;

            // Update badges
            if (job.isHot) {
                document.getElementById('hotBadge').classList.remove('hidden');
            }
            if (job.isUrgent) {
                document.getElementById('urgentBadge').classList.remove('hidden');
            }

            // Update basic info
            document.getElementById('jobSalary').textContent = job.salary;
            document.getElementById('jobLocation').textContent = job.location;
            document.getElementById('jobType').textContent = job.type;

            // Update company info
            document.getElementById('companyLogo').textContent = job.logo.substring(0, 1);
            document.getElementById('companyName').textContent = job.company;

            // Update job details
            document.getElementById('jobDescription').innerHTML = job.description;
            document.getElementById('jobRequirements').innerHTML = job.requirements;
            document.getElementById('jobBenefits').innerHTML = job.benefits;

            // Update right sidebar info
            document.getElementById('salaryInfo').textContent = job.salary;
            document.getElementById('experienceInfo').textContent = job.experience;
            document.getElementById('educationInfo').textContent = job.education;
            document.getElementById('typeInfo').textContent = job.type;
            document.getElementById('locationInfo').textContent = job.location;
            document.getElementById('postedDateInfo').textContent = job.postedDate;
            document.getElementById('deadlineInfo').textContent = job.deadline;

            // Load similar jobs
            loadSimilarJobs();
        }

        // Load similar jobs
        async function loadSimilarJobs() {
            try {
                const response = await fetch(`../../API/jobs/similar.php?id=${currentJob.id}`);
                const data = await response.json();
                
                if (data.ok) {
                    displaySimilarJobs(data.data);
                } else {
                    displaySimilarJobs([]);
                }
            } catch (error) {
                console.error('Error loading similar jobs:', error);
                displaySimilarJobs([]);
            }
        }

        // Display similar jobs
        function displaySimilarJobs(jobs) {
            const container = document.getElementById('similarJobs');
            
            if (jobs.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">Không có việc làm tương tự</p>';
                return;
            }

            container.innerHTML = jobs.map(job => `
                <div class="p-3 border border-gray-200 rounded-lg hover:border-fido-orange cursor-pointer" onclick="window.location.href='vieclam-chi-tiet.html?id=${job.id}'">
                    <h4 class="font-medium text-gray-800 text-sm mb-1">${job.title}</h4>
                    <p class="text-fido-orange text-xs font-medium">${job.salary}</p>
                    <p class="text-gray-600 text-xs">${job.location}</p>
                </div>
            `).join('');
        }

        // Toggle save job
        document.getElementById('saveJobBtn').addEventListener('click', async function() {
            if (!currentJob) return;

            try {
                const action = isJobSaved ? 'remove' : 'add';
                const response = await fetch(`../../API/ungvien/saved-${action}.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ job_id: currentJob.id })
                });

                const result = await response.json();
                
                if (result.ok) {
                    isJobSaved = !isJobSaved;
                    updateSaveButton();
                    showToast(isJobSaved ? 'Đã lưu tin tuyển dụng' : 'Đã bỏ lưu tin tuyển dụng', 'success');
                } else {
                    showToast('Có lỗi xảy ra', 'error');
                }
            } catch (error) {
                console.error('Error toggling save job:', error);
                // For demo purposes, toggle locally
                isJobSaved = !isJobSaved;
                updateSaveButton();
                showToast(isJobSaved ? 'Đã lưu tin tuyển dụng' : 'Đã bỏ lưu tin tuyển dụng', 'success');
            }
        });

        // Update save button appearance
        function updateSaveButton() {
            const btn = document.getElementById('saveJobBtn');
            if (isJobSaved) {
                btn.innerHTML = '<i class="fas fa-bookmark text-fido-orange"></i><span>Đã lưu</span>';
                btn.classList.add('text-fido-orange');
            } else {
                btn.innerHTML = '<i class="fas fa-bookmark"></i><span>Lưu tin</span>';
                btn.classList.remove('text-fido-orange');
            }
        }

        // Share job
        document.getElementById('shareJobBtn').addEventListener('click', function() {
            if (navigator.share) {
                navigator.share({
                    title: currentJob?.title || 'Việc làm tại Fidovn',
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href);
                showToast('Đã sao chép link vào clipboard', 'success');
            }
        });

        // Apply for job
        document.getElementById('applyNowBtn').addEventListener('click', function() {
            if (!currentJob) return;

            // Check if user is logged in
            const isLoggedIn = true; // This should check actual login status
            
            if (!isLoggedIn) {
                showToast('Vui lòng đăng nhập để ứng tuyển', 'error');
                return;
            }

            // Check if user has CV
            const hasCV = true; // This should check if user has CV
            
            if (!hasCV) {
                showToast('Vui lòng tạo CV trước khi ứng tuyển', 'error');
                window.location.href = 'quan-ly-cv.html';
                return;
            }

            // Navigate to application form
            window.location.href = `nopdon.html?job_id=${currentJob.id}`;
        });

        // Show toast message
        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Show error message
        function showError(message) {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
                <div class="flex items-center justify-center min-h-screen">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Có lỗi xảy ra</h2>
                        <p class="text-gray-600 mb-4">${message}</p>
                        <a href="vieclam.html" class="inline-block bg-fido-orange text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors">
                            Quay lại danh sách việc làm
                        </a>
                    </div>
                </div>
            `;
        }

        // Check authentication status
        async function checkAuth() {
            try {
                const response = await fetch('../../API/me.php');
                const result = await response.json();
                
                if (result.status === 'success') {
                    // User is logged in
                    document.getElementById('userInfo').classList.remove('hidden');
                    document.getElementById('loginButtons').classList.add('hidden');
                    document.getElementById('userName').textContent = result.user.ho_ten;
                    
                    // Update profile card with real user data
                    updateProfileCard(result.user);
                } else {
                    // User is not logged in
                    document.getElementById('userInfo').classList.add('hidden');
                    document.getElementById('loginButtons').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error checking auth:', error);
            }
        }

        // Update profile card with user data
        function updateProfileCard(user) {
            const profileCard = document.querySelector('.uv-brief-card');
            if (profileCard && user) {
                const nameElement = profileCard.querySelector('h4');
                const idElement = profileCard.querySelector('p:first-of-type');
                const emailElement = profileCard.querySelector('p:last-of-type');
                
                if (nameElement) nameElement.textContent = user.ho_ten;
                if (idElement) idElement.textContent = `ID: #${user.user_id}`;
                if (emailElement) emailElement.textContent = user.email;
            }
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('../../API/logout.php');
                const result = await response.json();
                
                if (result.status === 'success') {
                    window.location.href = '../login.html';
                }
            } catch (error) {
                console.error('Error logging out:', error);
                // Redirect anyway
                window.location.href = '../login.html';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadJobDetails();
        });
    </script>
</body>
</html>
